$(document).ready((function(){var e=[];function a(e){var a=e.header();null==a.WhiteElo?a.WhiteElo="":a.WhiteElo=" ("+a.WhiteElo+")",null==a.BlackElo?a.BlackElo="":a.BlackElo=" ("+a.BlackElo+")";var t="<h4>"+a.White+a.WhiteElo+" - "+a.Black+a.BlackElo+"</h4>";t+="<h5>"+a.Event+", "+a.Site+" "+a.EventDate+"</h5>";var n,r=e.pgn().replace(/\[(.*?)\]/gm,"").replace(a.Result,"").trim();moveArray=r.split(/([0-9]+\.\s)/).filter((function(e){return e}));for(var o=0,i=moveArray.length;o<i;++o){var s=$.trim(moveArray[o]);if(!/^[0-9]+\.$/.test(s)){m=s.split(/\s+/);for(var l=0,c=m.length;l<c;++l)m[l]='<span class="gameMove'+(o+l-1)+' move" data-value="'+(o+l-1)+'"><a id="myLink" href="#" value="'+(o+l-1)+'">'+m[l]+"</a></span>";s=m.join(" ")}moveArray[o]=s}var d=t+'<div class="gameMoves">'+moveArray.join(" ");a.Result&&(d+=' <span class="gameResult">'+a.Result+"</span></div>"),$("#game-data").html(d)}function t(e){e>s.length-1&&(e=s.length-1),o.reset();for(var a=0;a<=e;a++)o.move(s[a].san);l=a-1,r.position(o.fen())}$("#btnStart").on("click",(function(){o.reset(),l=-1,r.position(o.fen()),$("#currentFen").val(o.fen())})),$("#btnPrevious").on("click",(function(){l>=0&&(o.undo(),l--,r.position(o.fen()),$("#currentFen").val(o.fen()))})),$("#btnNext").on("click",(function(){l<s.length-1&&(l++,o.move(s[l].san),r.position(o.fen()),$("#currentFen").val(o.fen()))})),$("#btnEnd").on("click",(function(){for(;l<s.length-1;)l++,o.move(s[l].san);r.position(o.fen()),$("#currentFen").val(o.fen())}));var n=function e(){$("[class^='gameMove']").removeClass("highlight"),$(".gameMove"+l).addClass("highlight")},r,o,i,s,l,c;function d(e){return e.history().map((function(a){return e.move(a),e.fen()}))}function u(n){(o=new Chess).load_pgn(e[n].join("\n"),{newline_char:"\n"}),a(o),s=o.history({verbose:!0}),t(-1),c=n}function v(){$("#find_player").prop("disabled",!1)}$(document).keydown((function(a){return 39==a.keyCode?(a.ctrlKey?$("#btnEnd").click():$("#btnNext").click(),!1):37==a.keyCode?(a.ctrlKey?$("#btnStart").click():$("#btnPrevious").click(),!1):38==a.keyCode?(c>0&&(a.ctrlKey?u(0):u(c-1)),$("#gameSelect").val(c),!1):40==a.keyCode?(c<e.length-1&&(a.ctrlKey?u(e.length-1):u(c+1)),$("#gameSelect").val(c),!1):void 0})),$(document).delegate("#find_player","click",(function(a){a.preventDefault(),$("body, input").addClass("wait"),$("#find_player").prop("disabled",!0),r=new ChessBoard("board",p),$(window).resize(r.resize),$("#table").hide(),$("#game-data").hide();var t=[];e.length=0;var n=$("#player_name").val().toString().replace(",","");if(""==n)return alert("Has d'omplir algun nom"),v(),$("body, input").removeClass("wait"),!1;if(n.length<2)return alert("Has de posar un nom amb més d'una lletra"),v(),$("body, input").removeClass("wait"),!1;var o={player_name:n};$.ajax({data:o,dataType:"json",url:"src/ajaxrequest/get_games_player.php",type:"POST",error:function(e,a,t){v(),console.log("Error: "+JSON.parse(t)+" "+JSON.parse(a)+" "+JSON.parse(e))},success:function(a){if($("body, input").removeClass("wait"),"not_found"!=a.toString()){for(var n=0;n<a.length;n++){e.push(a[n]);var r=new Chess,o,i;r.load_pgn(a[n].join("\n"),{newline_char:"\n"});var s=r.header();void 0===s.Date&&(s.Date="-"),void 0===s.ECO&&(s.ECO="-"),void 0===s.Event&&(s.Event="-"),void 0===s.Result&&(s.Result="-"),void 0!==s.White&&void 0!==s.Black&&t.push({tournament:s.Event,year:s.Date,white:s.White,black:s.Black,result:s.Result,eco:s.ECO,btn:'<button class="edit btn btn-success show-pgn" value="'+n+'" type="button" title="Veure partida"><i class="fa fa-eye fa-lg"></i></button>'})}v(),$("#myTable").DataTable({data:t,pageLength:15,destroy:!0,order:[[0,"desc"]],columns:[{data:"tournament"},{data:"year"},{data:"white"},{data:"black"},{data:"result"},{data:"eco"},{data:"btn"}],language:{processing:"Processant...",search:"Cerca:",lengthMenu:"Mostrar _MENU_ registres",info:"Mostrant _START_ de _END_ d&apos;un total de _TOTAL_ registre(s)",infoEmpty:"Mostrant 0 de 0 d&apos;un total de 0 registres",infoFiltered:"(filtrat de _MAX_ registre(s) en total)",infoPostFix:"",loadingRecords:"S&apos;est&agrave; carregant...",zeroRecords:"No hi ha elements per mostrar",emptyTable:"No hi ha dades disponibles a la taula",paginate:{first:"Primer",previous:"Anterior",next:"Següent",last:"&Uacute;ltim"},aria:{sortAscending:": activeu per ordenar la columna en ordre ascendent",sortDescending:": activeu per ordenar la columna en ordre descendent"}}}),$("#table").show()}else alert("No s'ha trobat cap partida amb aquest criteri de búsqueda "),v()}})})),$(document).delegate(".show-pgn","click",(function(){var e;u($(this).val()),$("#game-data").show(),$("html, body").animate({scrollTop:0},"slow")})),$(document).delegate("#currentFen","click",(function(e){var a="https://lichess.org/analysis/standard/"+$(this).val();window.open(a,"_blank")})),$(document).delegate(".move","click",(function(){var e;t($(this).attr("data-value"))}));var p={pieceTheme:"chessboardjs/img/chesspieces/wikipedia/{piece}.png",position:"start",showNotation:!0,onChange:n};r=new ChessBoard("board",p),$(window).resize(r.resize)}));