$(document).ready((function(){var e=[];function a(e){var a=e.header();null==a.WhiteElo?a.WhiteElo="":a.WhiteElo=" ("+a.WhiteElo+")",null==a.BlackElo?a.BlackElo="":a.BlackElo=" ("+a.BlackElo+")";var t="<h4>"+a.White+a.WhiteElo+" - "+a.Black+a.BlackElo+"</h4>";t+="<h5>"+a.Event+", "+a.Site+" "+a.EventDate+"</h5>";var n,r=e.pgn().replace(/\[(.*?)\]/gm,"").replace(a.Result,"").trim();moveArray=r.split(/([0-9]+\.\s)/).filter((function(e){return e}));for(var o=0,l=moveArray.length;o<l;++o){var i=$.trim(moveArray[o]);if(!/^[0-9]+\.$/.test(i)){m=i.split(/\s+/);for(var s=0,c=m.length;s<c;++s)m[s]='<span class="gameMove'+(o+s-1)+' move" data-value="'+(o+s-1)+'"><a id="myLink" href="#" value="'+(o+s-1)+'">'+m[s]+"</a></span>";i=m.join(" ")}moveArray[o]=i}var d=t+'<div class="gameMoves">'+moveArray.join(" ");a.Result&&(d+=' <span class="gameResult">'+a.Result+"</span></div>"),$("#game-data").html(d)}function t(e){e>i.length-1&&(e=i.length-1),o.reset();for(var a=0;a<=e;a++)o.move(i[a].san);s=a-1,r.position(o.fen())}$(document).ajaxStart((function(){var e=$("#player_name").val().toString().replace(",",""),a=$("#player_surname").val().toString().replace(",",""),t=$("#player_surname2").val().toString().replace(",","");$(".loader-txt").html("<p>Buscant partides de <strong>"+e+" "+a+" "+t+"</strong><br><br><small>Esperi si us plau.</small></p>"),$("#loadMe").modal({backdrop:"static",keyboard:!1,show:!0})})),$(document).ajaxComplete((function(){$("#loadMe").modal("hide")})),$("#btnStart").on("click",(function(){o.reset(),s=-1,r.position(o.fen()),$("#currentFen").val(o.fen())})),$("#btnPrevious").on("click",(function(){s>=0&&(o.undo(),s--,r.position(o.fen()),$("#currentFen").val(o.fen()))})),$("#btnNext").on("click",(function(){s<i.length-1&&(s++,o.move(i[s].san),r.position(o.fen()),$("#currentFen").val(o.fen()))})),$("#btnEnd").on("click",(function(){for(;s<i.length-1;)s++,o.move(i[s].san);r.position(o.fen()),$("#currentFen").val(o.fen())}));var n=function e(){$("[class^='gameMove']").removeClass("highlight"),$(".gameMove"+s).addClass("highlight")},r,o,l,i,s,c;function d(e){return e.history().map((function(a){return e.move(a),e.fen()}))}function u(n){(o=new Chess).load_pgn(e[n].join("\n"),{newline_char:"\n"}),a(o),i=o.history({verbose:!0}),t(-1),c=n}function p(){$("#find_player").prop("disabled",!1)}$(document).keydown((function(a){return 39==a.keyCode?(a.ctrlKey?$("#btnEnd").click():$("#btnNext").click(),!1):37==a.keyCode?(a.ctrlKey?$("#btnStart").click():$("#btnPrevious").click(),!1):38==a.keyCode?(c>0&&(a.ctrlKey?u(0):u(c-1)),$("#gameSelect").val(c),!1):40==a.keyCode?(c<e.length-1&&(a.ctrlKey?u(e.length-1):u(c+1)),$("#gameSelect").val(c),!1):void 0})),$(document).delegate("#find_player","click",(function(a){a.preventDefault(),r=new ChessBoard("board",v),$(window).resize(r.resize),$("#table").hide(),$("#game-data").hide();var t=[];e.length=0;var n=$("#player_name").val().toString().replace(",",""),o=$("#player_surname").val().toString().replace(",",""),l=$("#player_surname2").val().toString().replace(",","");if(""==n&&""==o&&""==l)return alert("Has d'omplir algun nom"),p(),!1;if(n.length<2&&""==o&&""==l)return alert("Has de posar un nom amb més d'una lletra"),p(),!1;if(""==n&&o.length<2&&""==l)return alert("Has de posar un cognom1 amb més d'una lletra"),p(),!1;if(""==n.length&&""==o&&l.length<2)return alert("Has de posar un cognom2 amb més d'una lletra"),p(),!1;var i={player_name:n,player_surname:o,player_surname2:l};$.ajax({data:i,dataType:"json",url:"src/ajaxrequest/get_games_player.php",type:"POST",error:function(e,a,t){p(),$("#loadMe").modal("hide"),console.log("Error: "+JSON.parse(t)+" "+JSON.parse(a)+" "+JSON.parse(e))},beforeSend:function(){$("#find_player").prop("disabled",!0)},success:function(a){if("not_found"!=a.toString()){for(var n=0;n<a.length;n++){e.push(a[n]);var r=new Chess,o,l;r.load_pgn(a[n].join("\n"),{newline_char:"\n"});var i=r.header();void 0===i.Date&&(i.Date="-"),void 0===i.ECO&&(i.ECO="-"),void 0===i.Event&&(i.Event="-"),void 0===i.Result&&(i.Result="-"),void 0!==i.White&&void 0!==i.Black&&t.push({tournament:i.Event,year:i.Date,white:i.White,black:i.Black,result:i.Result,eco:i.ECO,btn:'<button class="edit btn btn-success show-pgn" value="'+n+'" type="button" title="Veure partida"><i class="fa fa-eye fa-lg"></i></button>'})}p(),$("#myTable").DataTable({data:t,pageLength:15,destroy:!0,order:[[0,"desc"]],columns:[{data:"tournament"},{data:"year"},{data:"white"},{data:"black"},{data:"result"},{data:"eco"},{data:"btn"}]}),$("#table").show()}else alert("No s'ha trobat cap partida amb aquest criteri de búsqueda "),p()}})})),$(document).delegate(".show-pgn","click",(function(){var e;u($(this).val()),$("#game-data").show(),$("html, body").animate({scrollTop:0},"slow")})),$(document).delegate("#currentFen","click",(function(e){var a="https://lichess.org/analysis/standard/"+$(this).val();window.open(a,"_blank")})),$(document).delegate(".move","click",(function(){var e;t($(this).attr("data-value"))}));var v={pieceTheme:"chessboardjs/img/chesspieces/wikipedia/{piece}.png",position:"start",showNotation:!0,onChange:n};r=new ChessBoard("board",v),$(window).resize(r.resize)}));