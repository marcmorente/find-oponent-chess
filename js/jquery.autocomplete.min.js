!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports&&"function"==typeof require?t(require("jquery")):t(jQuery)}((function(t){"use strict";var e={escapeRegExChars:function(t){return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")},createNode:function(t){var e=document.createElement("div");return e.className=t,e.style.position="absolute",e.style.display="none",e}},s=27,i=9,n=13,o=37,a=38,u=39,l=40,r=t.noop;function h(e,s){var i=this;this.element=e,this.el=t(e),this.suggestions=[],this.badQueries=[],this.selectedIndex=-1,this.currentValue=this.element.value,this.timeoutId=null,this.cachedResponse={},this.onChangeTimeout=null,this.onChange=null,this.isLocal=!1,this.suggestionsContainer=null,this.noSuggestionsContainer=null,this.options=t.extend(!0,{},h.defaults,s),this.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},this.hint=null,this.hintValue="",this.selection=null,this.initialize(),this.setOptions(s)}function c(t,e,s){return-1!==t.value.toLowerCase().indexOf(s)}function g(e){return"string"==typeof e?t.parseJSON(e):e}function d(t,s){if(!s)return t.value;var i="("+(s=e.escapeRegExChars(s)).replace(/\s+/g,"|")+")";return t.value.replace(new RegExp(i,"gi"),"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&lt;(\/?strong)&gt;/g,"<$1>")}function p(t,e){return'<div class="autocomplete-group">'+e+"</div>"}h.utils=e,t.Autocomplete=h,h.defaults={ajaxSettings:{},autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:d,formatGroup:p,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:r,onSearchComplete:r,onSearchError:r,preserveInput:!1,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:c,paramName:"query",transformResult:g,showNoSuggestionNotice:!1,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:!1},h.prototype={initialize:function(){var e=this,s="."+e.classes.suggestion,i=e.classes.selected,n=e.options,o;e.element.setAttribute("autocomplete","off"),e.noSuggestionsContainer=t('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0),e.suggestionsContainer=h.utils.createNode(n.containerClass),(o=t(e.suggestionsContainer)).appendTo(n.appendTo||"body"),"auto"!==n.width&&o.css("width",n.width),o.on("mouseover.autocomplete",s,(function(){e.activate(t(this).data("index"))})),o.on("mouseout.autocomplete",(function(){e.selectedIndex=-1,o.children("."+i).removeClass(i)})),o.on("click.autocomplete",s,(function(){e.select(t(this).data("index"))})),o.on("click.autocomplete",(function(){clearTimeout(e.blurTimeoutId)})),e.fixPositionCapture=function(){e.visible&&e.fixPosition()},t(window).on("resize.autocomplete",e.fixPositionCapture),e.el.on("keydown.autocomplete",(function(t){e.onKeyPress(t)})),e.el.on("keyup.autocomplete",(function(t){e.onKeyUp(t)})),e.el.on("blur.autocomplete",(function(){e.onBlur()})),e.el.on("focus.autocomplete",(function(){e.onFocus()})),e.el.on("change.autocomplete",(function(t){e.onKeyUp(t)})),e.el.on("input.autocomplete",(function(t){e.onKeyUp(t)}))},onFocus:function(){var t=this;this.disabled||(this.fixPosition(),this.el.val().length>=this.options.minChars&&this.onValueChange())},onBlur:function(){var e=this,s=e.options,i=e.el.val(),n=e.getQuery(i);e.blurTimeoutId=setTimeout((function(){e.hide(),e.selection&&e.currentValue!==n&&(s.onInvalidateSelection||t.noop).call(e.element)}),200)},abortAjax:function(){var t=this;this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null)},setOptions:function(e){var s=this,i=t.extend({},this.options,e);this.isLocal=Array.isArray(i.lookup),this.isLocal&&(i.lookup=this.verifySuggestionsFormat(i.lookup)),i.orientation=this.validateOrientation(i.orientation,"bottom"),t(this.suggestionsContainer).css({"max-height":i.maxHeight+"px",width:i.width+"px","z-index":i.zIndex}),this.options=i},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var t=this;this.disabled=!0,clearTimeout(this.onChangeTimeout),this.abortAjax()},enable:function(){this.disabled=!1},fixPosition:function(){var e=this,s=t(this.suggestionsContainer),i=s.parent().get(0);if(i===document.body||this.options.forceFixPosition){var n=this.options.orientation,o=s.outerHeight(),a=this.el.outerHeight(),u=this.el.offset(),l={top:u.top,left:u.left};if("auto"===n){var r=t(window).height(),h=t(window).scrollTop(),c=-h+u.top-o,g=h+r-(u.top+a+o);n=Math.max(c,g)===c?"top":"bottom"}if(l.top+="top"===n?-o:a,i!==document.body){var d=s.css("opacity"),p;this.visible||s.css("opacity",0).show(),p=s.offsetParent().offset(),l.top-=p.top,l.top+=i.scrollTop,l.left-=p.left,this.visible||s.css("opacity",d).hide()}"auto"===this.options.width&&(l.width=this.el.outerWidth()+"px"),s.css(l)}},isCursorAtEnd:function(){var t=this,e=this.el.val().length,s=this.element.selectionStart,i;return"number"==typeof s?s===e:!document.selection||((i=document.selection.createRange()).moveStart("character",-e),e===i.text.length)},onKeyPress:function(t){var e=this;if(this.disabled||this.visible||t.which!==l||!this.currentValue){if(!this.disabled&&this.visible){switch(t.which){case s:this.el.val(this.currentValue),this.hide();break;case u:if(this.hint&&this.options.onHint&&this.isCursorAtEnd()){this.selectHint();break}return;case i:if(this.hint&&this.options.onHint)return void this.selectHint();if(-1===this.selectedIndex)return void this.hide();if(this.select(this.selectedIndex),!1===this.options.tabDisabled)return;break;case n:if(-1===this.selectedIndex)return void this.hide();this.select(this.selectedIndex);break;case a:this.moveUp();break;case l:this.moveDown();break;default:return}t.stopImmediatePropagation(),t.preventDefault()}}else this.suggest()},onKeyUp:function(t){var e=this;if(!e.disabled){switch(t.which){case a:case l:return}clearTimeout(e.onChangeTimeout),e.currentValue!==e.el.val()&&(e.findBestHint(),e.options.deferRequestBy>0?e.onChangeTimeout=setTimeout((function(){e.onValueChange()}),e.options.deferRequestBy):e.onValueChange())}},onValueChange:function(){if(this.ignoreValueChange)this.ignoreValueChange=!1;else{var e=this,s=this.options,i=this.el.val(),n=this.getQuery(i);this.selection&&this.currentValue!==n&&(this.selection=null,(s.onInvalidateSelection||t.noop).call(this.element)),clearTimeout(this.onChangeTimeout),this.currentValue=i,this.selectedIndex=-1,s.triggerSelectOnValidInput&&this.isExactMatch(n)?this.select(0):n.length<s.minChars?this.hide():this.getSuggestions(n)}},isExactMatch:function(t){var e=this.suggestions;return 1===e.length&&e[0].value.toLowerCase()===t.toLowerCase()},getQuery:function(e){var s=this.options.delimiter,i;return s?(i=e.split(s),t.trim(i[i.length-1])):e},getSuggestionsLocal:function(e){var s=this,i=this.options,n=e.toLowerCase(),o=i.lookupFilter,a=parseInt(i.lookupLimit,10),u;return u={suggestions:t.grep(i.lookup,(function(t){return o(t,e,n)}))},a&&u.suggestions.length>a&&(u.suggestions=u.suggestions.slice(0,a)),u},getSuggestions:function(e){var s,i=this,n=i.options,o=n.serviceUrl,a,u,l;n.params[n.paramName]=e,!1!==n.onSearchStart.call(i.element,n.params)&&(a=n.ignoreParams?null:n.params,t.isFunction(n.lookup)?n.lookup(e,(function(t){i.suggestions=t.suggestions,i.suggest(),n.onSearchComplete.call(i.element,e,t.suggestions)})):(i.isLocal?s=i.getSuggestionsLocal(e):(t.isFunction(o)&&(o=o.call(i.element,e)),u=o+"?"+t.param(a||{}),s=i.cachedResponse[u]),s&&Array.isArray(s.suggestions)?(i.suggestions=s.suggestions,i.suggest(),n.onSearchComplete.call(i.element,e,s.suggestions)):i.isBadQuery(e)?n.onSearchComplete.call(i.element,e,[]):(i.abortAjax(),l={url:o,data:a,type:n.type,dataType:n.dataType},t.extend(l,n.ajaxSettings),i.currentRequest=t.ajax(l).done((function(t){var s;i.currentRequest=null,s=n.transformResult(t,e),i.processResponse(s,e,u),n.onSearchComplete.call(i.element,e,s.suggestions)})).fail((function(t,s,o){n.onSearchError.call(i.element,e,t,s,o)})))))},isBadQuery:function(t){if(!this.options.preventBadQueries)return!1;for(var e=this.badQueries,s=e.length;s--;)if(0===t.indexOf(e[s]))return!0;return!1},hide:function(){var e=this,s=t(this.suggestionsContainer);t.isFunction(this.options.onHide)&&this.visible&&this.options.onHide.call(this.element,s),this.visible=!1,this.selectedIndex=-1,clearTimeout(this.onChangeTimeout),t(this.suggestionsContainer).hide(),this.signalHint(null)},suggest:function(){if(this.suggestions.length){var e=this,s=this.options,i=s.groupBy,n=s.formatResult,o=this.getQuery(this.currentValue),a=this.classes.suggestion,u=this.classes.selected,l=t(this.suggestionsContainer),r=t(this.noSuggestionsContainer),h=s.beforeRender,c="",g,d=function(t,e){var n=t.data[i];return g===n?"":(g=n,s.formatGroup(t,g))};s.triggerSelectOnValidInput&&this.isExactMatch(o)?this.select(0):(t.each(this.suggestions,(function(t,e){i&&(c+=d(e,o,t)),c+='<div class="'+a+'" data-index="'+t+'">'+n(e,o,t)+"</div>"})),this.adjustContainerWidth(),r.detach(),l.html(c),t.isFunction(h)&&h.call(this.element,l,this.suggestions),this.fixPosition(),l.show(),s.autoSelectFirst&&(this.selectedIndex=0,l.scrollTop(0),l.children("."+a).first().addClass(u)),this.visible=!0,this.findBestHint())}else this.options.showNoSuggestionNotice?this.noSuggestions():this.hide()},noSuggestions:function(){var e=this,s=this.options.beforeRender,i=t(this.suggestionsContainer),n=t(this.noSuggestionsContainer);this.adjustContainerWidth(),n.detach(),i.empty(),i.append(n),t.isFunction(s)&&s.call(this.element,i,this.suggestions),this.fixPosition(),i.show(),this.visible=!0},adjustContainerWidth:function(){var e=this,s=this.options,i,n=t(this.suggestionsContainer);"auto"===s.width?(i=this.el.outerWidth(),n.css("width",i>0?i:300)):"flex"===s.width&&n.css("width","")},findBestHint:function(){var e=this,s=this.el.val().toLowerCase(),i=null;s&&(t.each(this.suggestions,(function(t,e){var n=0===e.value.toLowerCase().indexOf(s);return n&&(i=e),!n})),this.signalHint(i))},signalHint:function(e){var s="",i=this;e&&(s=this.currentValue+e.value.substr(this.currentValue.length)),this.hintValue!==s&&(this.hintValue=s,this.hint=e,(this.options.onHint||t.noop)(s))},verifySuggestionsFormat:function(e){return e.length&&"string"==typeof e[0]?t.map(e,(function(t){return{value:t,data:null}})):e},validateOrientation:function(e,s){return e=t.trim(e||"").toLowerCase(),-1===t.inArray(e,["auto","bottom","top"])&&(e=s),e},processResponse:function(t,e,s){var i=this,n=this.options;t.suggestions=this.verifySuggestionsFormat(t.suggestions),n.noCache||(this.cachedResponse[s]=t,n.preventBadQueries&&!t.suggestions.length&&this.badQueries.push(e)),e===this.getQuery(this.currentValue)&&(this.suggestions=t.suggestions,this.suggest())},activate:function(e){var s=this,i,n=this.classes.selected,o=t(this.suggestionsContainer),a=o.find("."+this.classes.suggestion);return o.find("."+n).removeClass(n),this.selectedIndex=e,-1!==this.selectedIndex&&a.length>this.selectedIndex?(i=a.get(this.selectedIndex),t(i).addClass(n),i):null},selectHint:function(){var e=this,s=t.inArray(this.hint,this.suggestions);this.select(s)},select:function(t){var e=this;this.hide(),this.onSelect(t)},moveUp:function(){var e=this;if(-1!==this.selectedIndex)return 0===this.selectedIndex?(t(this.suggestionsContainer).children("."+this.classes.suggestion).first().removeClass(this.classes.selected),this.selectedIndex=-1,this.ignoreValueChange=!1,this.el.val(this.currentValue),void this.findBestHint()):void this.adjustScroll(this.selectedIndex-1)},moveDown:function(){var t=this;this.selectedIndex!==this.suggestions.length-1&&this.adjustScroll(this.selectedIndex+1)},adjustScroll:function(e){var s=this,i=this.activate(e);if(i){var n,o,a,u=t(i).outerHeight();n=i.offsetTop,a=(o=t(this.suggestionsContainer).scrollTop())+this.options.maxHeight-u,n<o?t(this.suggestionsContainer).scrollTop(n):n>a&&t(this.suggestionsContainer).scrollTop(n-this.options.maxHeight+u),this.options.preserveInput||(this.ignoreValueChange=!0,this.el.val(this.getValue(this.suggestions[e].value))),this.signalHint(null)}},onSelect:function(e){var s=this,i=this.options.onSelect,n=this.suggestions[e];this.currentValue=this.getValue(n.value),this.currentValue===this.el.val()||this.options.preserveInput||this.el.val(this.currentValue),this.signalHint(null),this.suggestions=[],this.selection=n,t.isFunction(i)&&i.call(this.element,n)},getValue:function(t){var e=this,s=this.options.delimiter,i,n;return s?1===(n=(i=this.currentValue).split(s)).length?t:i.substr(0,i.length-n[n.length-1].length)+t:t},dispose:function(){var e=this;this.el.off(".autocomplete").removeData("autocomplete"),t(window).off("resize.autocomplete",this.fixPositionCapture),t(this.suggestionsContainer).remove()}},t.fn.devbridgeAutocomplete=function(e,s){var i="autocomplete";return arguments.length?this.each((function(){var n=t(this),o=n.data(i);"string"==typeof e?o&&"function"==typeof o[e]&&o[e](s):(o&&o.dispose&&o.dispose(),o=new h(this,e),n.data(i,o))})):this.first().data(i)},t.fn.autocomplete||(t.fn.autocomplete=t.fn.devbridgeAutocomplete)}));